<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×™×•××Ÿ ××¡×—×¨ - Trading Journal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f1e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            margin-bottom: 30px;
            text-align: right;
        }

        .header h1 {
            font-size: 42px;
            color: #ffffff;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #9ca3af;
            font-size: 16px;
        }

        .sync-tools {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .sync-tools-title {
            color: #60a5fa;
            font-weight: 600;
            margin-left: 20px;
            flex: 1 1 100%;
            margin-bottom: 10px;
        }

        .add-trade-section {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid #374151;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            color: #ffffff;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 2fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            color: #9ca3af;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input, textarea {
            background: rgba(17, 24, 39, 0.8);
            border: 1px solid #4b5563;
            border-radius: 8px;
            padding: 12px;
            color: #e5e7eb;
            font-size: 15px;
            transition: all 0.3s;
        }

        textarea {
            resize: vertical;
            min-height: 45px;
            font-family: inherit;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .btn-small {
            padding: 10px 20px;
            font-size: 14px;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-delete {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            padding: 8px 16px;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid #374151;
            border-radius: 16px;
            padding: 25px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .stat-label {
            color: #9ca3af;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
        }

        .profit { color: #10b981; }
        .loss { color: #ef4444; }
        .neutral { color: #60a5fa; }

        .chart-container {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid #374151;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .table-container {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid #374151;
            border-radius: 16px;
            padding: 30px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: right;
            padding: 15px;
            color: #9ca3af;
            font-weight: 600;
            border-bottom: 2px solid #374151;
            font-size: 13px;
        }

        td {
            text-align: right;
            padding: 15px;
            color: #e5e7eb;
            border-bottom: 1px solid rgba(55, 65, 81, 0.5);
            font-size: 14px;
        }

        tr:hover {
            background: rgba(55, 65, 81, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #93c5fd;
            font-size: 13px;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .sync-tools {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ˆ ×™×•××Ÿ ××¡×—×¨</h1>
            <p>××¢×§×‘ ××—×¨ ×”×¢×¡×§××•×ª ×©×œ×š</p>
        </div>

        <!-- ×›×œ×™ ×¡× ×›×¨×•×Ÿ -->
        <div class="sync-tools">
            <div class="sync-tools-title">ğŸ”„ ×”×¢×‘×¨×ª × ×ª×•× ×™× ×‘×™×Ÿ ××›×©×™×¨×™×:</div>
            <button class="btn btn-small btn-success" onclick="exportData()">ğŸ“¤ ×™×™×¦× × ×ª×•× ×™×</button>
            <button class="btn btn-small" onclick="document.getElementById('fileInput').click()">ğŸ“¥ ×™×™×‘× × ×ª×•× ×™×</button>
            <input type="file" id="fileInput" accept=".json" onchange="importData(event)">
            <div class="info-box" style="flex: 1 1 100%;">
                ğŸ’¡ <strong>××™×š ×–×” ×¢×•×‘×“:</strong> ×œ×—×¥ "×™×™×¦× × ×ª×•× ×™×" ×›×“×™ ×œ×”×•×¨×™×“ ×§×•×‘×¥. ×©×œ×— ××ª ×”×§×•×‘×¥ ×œ××™×™×¤×•×Ÿ ×©×œ×š (WhatsApp/Email) ×•×¤×ª×— ××•×ª×• ×©×. ××—×¨ ×›×š ×œ×—×¥ "×™×™×‘× × ×ª×•× ×™×" ×‘××™×™×¤×•×Ÿ ×›×“×™ ×œ×˜×¢×•×Ÿ ××ª ×›×œ ×”×¢×¡×§××•×ª!
            </div>
        </div>

        <!-- ×”×•×¡×¤×ª ×¢×¡×§×” -->
        <div class="add-trade-section">
            <h2 class="section-title">â• ×”×•×¡×£ ×¢×¡×§×”</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>×ª××¨×™×š</label>
                    <input type="date" id="tradeDate" required>
                </div>
                <div class="form-group">
                    <label>×¨×•×•×—/×”×¤×¡×“ ($)</label>
                    <input type="number" id="pnl" step="0.01" placeholder="100.00 ××• -50.00" required>
                </div>
                <div class="form-group">
                    <label>×”×¢×¨×•×ª (××•×¤×¦×™×•× ×œ×™)</label>
                    <textarea id="notes" placeholder="NQ LONG, ES SHORT, ×•×›×•'..."></textarea>
                </div>
            </div>
            <button class="btn" onclick="addTrade()">ğŸ’¾ ×©××•×¨ ×¢×¡×§×”</button>
        </div>

        <!-- ×¡×˜×˜×™×¡×˜×™×§×•×ª -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">×¡×š ×”×›×œ P&L</div>
                <div class="stat-value" id="totalPnL">$0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">××¡×¤×¨ ×¢×¡×§××•×ª</div>
                <div class="stat-value neutral" id="totalTrades">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">×××•×¦×¢ ×œ×¢×¡×§×”</div>
                <div class="stat-value" id="avgTrade">$0.00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">××—×•×– ×”×¦×œ×—×”</div>
                <div class="stat-value neutral" id="winRate">0%</div>
            </div>
        </div>

        <!-- ×’×¨×£ -->
        <div class="chart-container">
            <h2 class="section-title">×¢×§×•××ª ×”×•×Ÿ ×™×•××™×ª</h2>
            <canvas id="equityChart"></canvas>
        </div>

        <!-- ×˜×‘×œ×ª ×™××™ ××¡×—×¨ -->
        <div class="table-container">
            <h2 class="section-title">×™××™ ××¡×—×¨</h2>
            <div id="dailyTable"></div>
        </div>

        <!-- ×˜×‘×œ×ª ×¢×¡×§××•×ª -->
        <div class="table-container" style="margin-top: 30px;">
            <h2 class="section-title">×›×œ ×”×¢×¡×§××•×ª</h2>
            <div id="tradesTable"></div>
        </div>
    </div>

    <script>
        let trades = [];
        let chart = null;

        // ×˜×¢×™× ×ª × ×ª×•× ×™×
        function loadData() {
            const saved = localStorage.getItem('tradingJournal');
            if (saved) {
                trades = JSON.parse(saved);
                updateUI();
            }
            document.getElementById('tradeDate').valueAsDate = new Date();
        }

        // ×©××™×¨×ª × ×ª×•× ×™×
        function saveData() {
            localStorage.setItem('tradingJournal', JSON.stringify(trades));
        }

        // ×™×™×¦×•× × ×ª×•× ×™×
        function exportData() {
            const dataStr = JSON.stringify(trades, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `trading_journal_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('âœ… ×”×§×•×‘×¥ ×”×•×¨×“ ×‘×”×¦×œ×—×”! ×¢×›×©×™×• ×©×œ×— ××•×ª×• ×œ××™×™×¤×•×Ÿ ×©×œ×š ×“×¨×š WhatsApp/Email');
        }

        // ×™×™×‘×•× × ×ª×•× ×™×
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedTrades = JSON.parse(e.target.result);
                    
                    if (confirm(`× ××¦××• ${importedTrades.length} ×¢×¡×§××•×ª. ×”×× ×œ×”×—×œ×™×£ ××ª ×›×œ ×”× ×ª×•× ×™× ×”×§×™×™××™×?`)) {
                        trades = importedTrades;
                        saveData();
                        updateUI();
                        alert('âœ… ×”× ×ª×•× ×™× ×™×•×‘××• ×‘×”×¦×œ×—×”!');
                    }
                } catch (error) {
                    alert('âŒ ×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥. ×× × ×•×“× ×©×–×” ×§×•×‘×¥ JSON ×ª×§×™×Ÿ.');
                }
            };
            reader.readAsText(file);
            
            // ××¤×¡ ××ª ×”-input ×›×“×™ ×œ××¤×©×¨ ×™×™×‘×•× ×©×œ ××•×ª×• ×§×•×‘×¥ ×©×•×‘
            event.target.value = '';
        }

        // ×”×•×¡×¤×ª ×¢×¡×§×”
        function addTrade() {
            const date = document.getElementById('tradeDate').value;
            const pnl = parseFloat(document.getElementById('pnl').value);
            const notes = document.getElementById('notes').value;

            if (!date || isNaN(pnl)) {
                alert('×× × ××œ× ×ª××¨×™×š ×•×¨×•×•×—/×”×¤×¡×“');
                return;
            }

            const trade = {
                id: Date.now(),
                date,
                pnl: parseFloat(pnl.toFixed(2)),
                notes
            };

            trades.push(trade);
            trades.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            saveData();
            updateUI();

            // × ×™×§×•×™ ×˜×•×¤×¡
            document.getElementById('pnl').value = '';
            document.getElementById('notes').value = '';
            document.getElementById('tradeDate').valueAsDate = new Date();
        }

        // ××—×™×§×ª ×¢×¡×§×”
        function deleteTrade(id) {
            if (confirm('×”×× ×œ××—×•×§ ××ª ×”×¢×¡×§×”?')) {
                trades = trades.filter(t => t.id !== id);
                saveData();
                updateUI();
            }
        }

        // ×¢×“×›×•×Ÿ ×××©×§
        function updateUI() {
            updateStats();
            updateChart();
            updateDailyTable();
            updateTradesTable();
        }

        // ×¢×“×›×•×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª
        function updateStats() {
            const totalPnL = trades.reduce((sum, t) => sum + t.pnl, 0);
            const totalTrades = trades.length;
            const avgTrade = totalTrades > 0 ? totalPnL / totalTrades : 0;
            const winners = trades.filter(t => t.pnl > 0).length;
            const winRate = totalTrades > 0 ? (winners / totalTrades * 100) : 0;

            document.getElementById('totalPnL').textContent = `$${totalPnL.toFixed(2)}`;
            document.getElementById('totalPnL').className = `stat-value ${totalPnL >= 0 ? 'profit' : 'loss'}`;
            
            document.getElementById('totalTrades').textContent = totalTrades;
            
            document.getElementById('avgTrade').textContent = `$${avgTrade.toFixed(2)}`;
            document.getElementById('avgTrade').className = `stat-value ${avgTrade >= 0 ? 'profit' : 'loss'}`;
            
            document.getElementById('winRate').textContent = `${winRate.toFixed(1)}%`;
        }

        // ×¢×“×›×•×Ÿ ×’×¨×£
        function updateChart() {
            const ctx = document.getElementById('equityChart').getContext('2d');
            
            const dailyData = {};
            trades.forEach(trade => {
                if (!dailyData[trade.date]) {
                    dailyData[trade.date] = 0;
                }
                dailyData[trade.date] += trade.pnl;
            });

            const dates = Object.keys(dailyData).sort();
            let cumulative = 0;
            const chartData = dates.map(date => {
                cumulative += dailyData[date];
                return {
                    date,
                    daily: dailyData[date],
                    cumulative
                };
            });

            if (chart) {
                chart.destroy();
            }

            if (chartData.length === 0) {
                return;
            }

            const isProfit = cumulative >= 0;
            const lineColor = isProfit ? '#10b981' : '#ef4444';

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.map(d => d.date),
                    datasets: [{
                        label: '×”×•×Ÿ ××¦×˜×‘×¨',
                        data: chartData.map(d => d.cumulative),
                        borderColor: lineColor,
                        backgroundColor: isProfit ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: lineColor,
                        pointBorderColor: '#1f2937',
                        pointBorderWidth: 2,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(17, 24, 39, 0.95)',
                            titleColor: '#e5e7eb',
                            bodyColor: '#e5e7eb',
                            borderColor: '#374151',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    const daily = chartData[context.dataIndex].daily;
                                    return [
                                        `××¦×˜×‘×¨: $${context.parsed.y.toFixed(2)}`,
                                        `×™×•××™: $${daily.toFixed(2)}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(55, 65, 81, 0.3)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#9ca3af',
                                font: { size: 11 }
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(55, 65, 81, 0.3)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#9ca3af',
                                font: { size: 11 },
                                callback: value => '$' + value.toFixed(0)
                            }
                        }
                    }
                }
            });
        }

        // ×¢×“×›×•×Ÿ ×˜×‘×œ×ª ×™××™×
        function updateDailyTable() {
            const container = document.getElementById('dailyTable');
            
            const dailyData = {};
            trades.forEach(trade => {
                if (!dailyData[trade.date]) {
                    dailyData[trade.date] = {
                        date: trade.date,
                        pnl: 0,
                        count: 0
                    };
                }
                dailyData[trade.date].pnl += trade.pnl;
                dailyData[trade.date].count += 1;
            });

            const dailyArray = Object.values(dailyData).sort((a, b) => new Date(b.date) - new Date(a.date));

            if (dailyArray.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ“Š</div>
                        <h3 style="color: #9ca3af; margin-bottom: 10px;">××™×Ÿ ×¢×¡×§××•×ª ×¢×“×™×™×Ÿ</h3>
                        <p style="color: #6b7280;">×”×•×¡×£ ××ª ×”×¢×¡×§×” ×”×¨××©×•× ×” ×©×œ×š ×œ××¢×œ×”</p>
                    </div>
                `;
                return;
            }

            let cumulative = 0;
            const reversedArray = [...dailyArray].reverse();
            reversedArray.forEach(day => {
                cumulative += day.pnl;
                day.cumulative = cumulative;
            });

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>×ª××¨×™×š</th>
                            <th>××¡×¤×¨ ×¢×¡×§××•×ª</th>
                            <th>P&L ×™×•××™</th>
                            <th>P&L ××¦×˜×‘×¨</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            dailyArray.forEach(day => {
                html += `
                    <tr>
                        <td><strong>${day.date}</strong></td>
                        <td>${day.count}</td>
                        <td class="${day.pnl >= 0 ? 'profit' : 'loss'}" style="font-weight: 700; font-size: 16px;">
                            $${day.pnl.toFixed(2)}
                        </td>
                        <td class="${day.cumulative >= 0 ? 'profit' : 'loss'}" style="font-weight: 600;">
                            $${day.cumulative.toFixed(2)}
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // ×¢×“×›×•×Ÿ ×˜×‘×œ×ª ×¢×¡×§××•×ª
        function updateTradesTable() {
            const container = document.getElementById('tradesTable');
            
            if (trades.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p style="color: #6b7280;">××™×Ÿ ×¢×¡×§××•×ª</p>
                    </div>
                `;
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>×ª××¨×™×š</th>
                            <th>P&L</th>
                            <th>×”×¢×¨×•×ª</th>
                            <th>×¤×¢×•×œ×•×ª</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            trades.slice().reverse().forEach(trade => {
                html += `
                    <tr>
                        <td>${trade.date}</td>
                        <td class="${trade.pnl >= 0 ? 'profit' : 'loss'}" style="font-weight: 700; font-size: 16px;">
                            $${trade.pnl.toFixed(2)}
                        </td>
                        <td style="color: #9ca3af;">${trade.notes || '-'}</td>
                        <td>
                            <button class="btn btn-delete" onclick="deleteTrade(${trade.id})">ğŸ—‘ï¸ ××—×§</button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // ×˜×¢×™× ×” ×¨××©×•× ×™×ª
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>